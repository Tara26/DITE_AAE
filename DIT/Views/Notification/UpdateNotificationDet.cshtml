@model Models.ExamNotification.Notification
@{
    Layout = null;

    //int sno = 1;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <link href="~/Content/jquery.dataTables.min.css" rel="stylesheet" />
    <script src="~/Scripts/jquery.dataTables.min.js"></script>
    <script src="~/Content/frontend/js/bootstrap.js"></script>
    <script src="~/Scripts/bootbox.js"></script>
    <script src="~/Scripts/bootbox.min.js"></script>
    <script src="~/Scripts/bootbox.locales.min.js"></script>
    <script src="~/Content/frontend/js/jquery-ui.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
    <title>UpdateNotificationDet</title>
</head>
<body>
    <div>
        <div class="content">
            <input type="hidden" value="@Model.Exam_Notif_Id" name="Exam_Notif_Id" />
            <input type="hidden" value="@Model.Exam_Notif_Number" name="Exam_Notif_Number" />
            <div class="container" style="background-color:white;box-shadow: 0 2px 4px rgba(0,0,0,0.6);margin-top:20px; padding:20px;">
                <div class="col-lg-12 borderedtext" align="left">
                    <h4 style="color:white;background-color:cornflowerblue;">Upload Exam Attendance Details</h4>
                </div>
                <br/>
                <br/>
                <table class="table table-bordered table-hover text-center " style="color:white; background-color:aliceblue" id="tblGrid">
                    <thead>
                        <tr class="text-center" style="color:black">
                            <th>SlNo.</th>
                            <th>Course Type</th>
                            <th style="width:-550px;">Name of the Department</th>
                            <th>Notification Number</th>
                            <th>Notification Description</th>
                            <th>Date and Time</th>
                            <th>Status</th>
                            @*<th>Remarks</th>
                    <th>ViewFile</th>*@

                            <th colspan="2" style="width:250px;">Action</th>

                        </tr>
                    </thead>
                    <tbody style="color:Black;">
                        @foreach (var item in Model.GetUpdateNotifDet)
                        {
                            <tr>
                                @*<td>@(sno++)</td>*@
                                <td align="center" class="noExport">@item.Exam_Notif_Id</td>
                                <td>@item.CourseTypeName</td>
                                <td>@item.DeptName</td>
                                <td>@item.Exam_Notif_Number</td>
                                <td>@item.Exam_Notif_Desc</td>
                                <td>@item.Exam_notif_date.ToString("dd/MM/yyyy")</td>
                                <td>@item.exam_notif_status_desc</td>
                                @*<td>@item.comments</td>*@
                                @*<td> <a href="@Url.Content("../../" + item.SavePath)" data-toggle="tooltip" data-placement="top" title="View Existing File" class="View" style="color:black" target="_blank">FileView</a></td>*@

                                @*<a style="text-align:center; float:initial" class="btn btn-primary" @*id="filepath"onclick="GetClientReport()">View Notification</a>*@

                                <td>
                                    @if (item.exam_notif_status_desc == "Changes/Modifications" || item.exam_notif_status_desc == "Published Notification" || item.exam_notif_status_desc == "Modification To Published Notic")
                                    {
                                        <a class=" btn btn-primary" href='@Url.Action("CreateNotification", "Notification", new { NotificationId = item.Exam_Notif_Id})'>Edit</a>
                                    }

                                    @if (item.exam_notif_status_desc == "Approved - Pending for Publish")
                                    {
                                        <a class="btn btn-primary" id="sendBtn" onclick="PublishDetails(@item.Exam_Notif_Id,@item.exam_notif_status_id +2)">Publish</a>
                                    }

                                    <a class="btn btn-primary" id="sendBtn" onclick="GetCommentFileDetails(@item.Exam_Notif_Id)">View</a>
                                </td>


                            </tr>
                        }
                    </tbody>
                </table>
            </div>
            </div>

        </div>

   
    <div class="modal fade" id="RemarksCommentsModal" role="dialog">
        <div class="modal-dialog modal-xl" style="width: 60%; margin: 30px auto; padding: 2px;">
            <div class="modal-content" style="padding:15px;">
                <div class="modal-header">
                    <h4 class="modal-title">Remark Details</h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <br />
                <div>
                    <input type="button" value="ViewNotificationFile" class="btn btn-primary" onclick="GetClientReport()" style="margin-left:15px; width:250px;" id="btnFileView" />
                </div>
                <br />

                <table class="table table-striped table-hover text-center shadow clswidth" id="GetCommentRemarkstbl" style="width:100% !important" border="1" align="center"></table>

                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal" style="width: 20%;">OK</button>
                </div>
            </div>
        </div>
    </div>


</body>
</html>

<script>
    //function GetClientReport() {
    //    debugger;
    //    window.open('/Notification/GetReport');
    //};


    $(document).ready(function () {
        $('#tblGridUpdate').DataTable({

        });
    });
    function GetCommentFileDetails(id) {
        
        $('#RemarksCommentsModal').modal('show');
        //NotifId = id;
        debugger;
        $.ajax({
            type: "Post",
            url: "/Notification/GetCommentFileDetails",
            data: { NotificationId: id },
            success: function (data) {
                var t = $('#GetCommentRemarkstbl').DataTable({
                    data: data,
                    destroy: true,
                    columns: [
                        //{ 'data': 'createdatetime', 'title': 'Sl No', 'className': 'text-center' },
                        //{ 'data': 'createdatetime', 'title': 'Date', 'className': 'text-left' },
                        //{ 'data': 'Exam_Notif_Number', 'title': 'Notification Number', 'className': 'text-left' },
                        //{ 'data': 'comments', 'title': 'Descriptioon', 'className': 'text-left' },
                        //{ 'data': 'user_name', 'title': 'Designation', 'className': 'text-left' },
                        { 'data': 'creationdatetime', 'title': 'Sl No', 'className': 'text-center' },
                        { 'data': 'creationdatetime', 'title': 'Date', 'className': 'text-left' },
                        { 'data': 'By', 'title': 'By', 'className': 'text-left' },
                        { 'data': 'Status', 'title': 'Status', 'className': 'text-left' },
                        { 'data': 'comments', 'title': 'Comments', 'className': 'text-left' },

                    ]
                });
                t.on('order.dt search.dt', function () {
                    t.column(0, { search: 'applied', order: 'applied' }).nodes().each(function (cell, i) {
                        cell.innerHTML = i + 1;
                    });
                }).draw();
                NotifId= data[0].Exam_Notif_Number;
            }
        });
    }

    function GetClientReport() {
        debugger;
        var urlPath = "../../Content//Template//Notification_" + NotifId + ".pdf";
        window.open(urlPath, '_blank');
        //$.ajax({
        //    type: "POST",
        //    url: "/Notification/GetReport",
        //    dataType: 'json',
        //    data: {
        //        // __RequestVerificationToken: token,
        //        Filepath: NotifId

        //    },
        //    success: function (response) {
        //        debugger;
        //        window.open("data:application/pdf;base64, " + response, '_blank');
        //    }, error: function (e) {
        //        var _msg = "Something went wrong.";
        //        bootbox.alert(_msg);
        //        $("#preloder, .loader").hide();
        //    }
        //})
        //window.open('/Notification/GetReport');
    }

    function PublishDetails(id, status) {
        debugger;
        $.ajax({
            type: "POST",
            url: "/Notification/PublishNotification",
            dataType: 'json',
            data: {
                Id: id,
                Status: status,
                //Loginid: RoleId,
            },

            success: function (response) {
                debugger;
                if (response == "Saved") {
                    //$('#sendBtn').attr("disabled", "disabled");
                    var _msg = "Published  Successfully";
                    //bootbox.alert(_msg);
                    bootbox.alert({ message: _msg, callback: function () { window.location.href = window.location.href; } });
                }
                else {
                    var _msg = "Fail to send";
                    bootbox.alert(_msg);
                }
            }, error: function (e) {
                var _msg = "Something went wrong.";
                bootbox.alert(_msg);
                $("#preloder, .loader").hide();
            }
        });
    }

</script>
<script type="text/javascript">
    var selectedTab = '@Model.selectTab';
    var NotifId = '@Model.Exam_Notif_Number';

</script>
    