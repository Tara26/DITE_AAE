@model Models.AttendanceDetails.AtendanceDet
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<link href="~/Content/css/jquery.dataTables.min.css" rel="stylesheet" />
<script src="~/Scripts/jquery.dataTables.min.js"></script>
<script src="~/Content/frontend/js/bootstrap.js"></script>
<script src="~/Scripts/bootbox.js"></script>
<script src="~/Scripts/bootbox.min.js"></script>
<script src="~/Scripts/bootbox.locales.min.js"></script>
<script src="~/Content/frontend/js/jquery-ui.min.js"></script>
<link rel="stylesheet" href="~/Content/css/jquery-ui.min.css" type="text/css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>


<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>GetExamAttendanceDtls</title>
</head>
<body>
    <div>
        <br /><br /><br />
        <input type="hidden" value="@Model.attendSavePath" name="attendSavePath" id="test"/>
        <table class="table table-bordered table-hover text-center " style="color:white; background-color:aliceblue" id="tblGrid">
            <thead>
                <tr class="text-center" style="color:black">
                    <th>SlNo.</th>
                    <th>Exam Day</th>

                    <th>Block Number</th>
                    <th>Trainee Roll No.</th>
                    <th> Status</th>

                    <th style="display:none">InvigilatorDairy</th>
                    <th style="display:none">ExcelInvigilatorDairy</th>
                    <th>Send To</th>
                    <th>Send</th>

                    <th>Action</th>
                </tr>
            </thead>
            <tbody style="color:Black;">
                @foreach (var item in Model.AttendanceDetList)
                {
                <tr>
                    @*<td>@(sno++)</td>*@
                    <td align="center" class="noExport">@item.attenId</td>
                    <td>@item.Day</td>
                    <td>@item.BlockNo</td>
                    <td>@item.Trainee_Roll_Num</td>
                    <td>@item.status_desc</td>
                    <td style="display:none" id="filename">@item.attendSavePath</td>
                    <td style="display:none">@item.attendExcelPath</td>

                    <td>
                        @if (item.status_desc.ToString().Equals("Ready to Send for Approval"))
                        {
                            @Html.DropDownListFor(model => model.RoleId, new SelectList(Model.LoginRoleList, "Value", "Text"), new { @class = "form-control select2", @onchange = "GetSelectedValue(this.value)" })
                            @Html.ValidationMessageFor(x => x.RoleId, "", new { @class = "text-danger" })

                        }
                        else
                        {
                            @Html.DropDownListFor(model => model.RoleId, new SelectList(Model.LoginRoleList, "Value", "Text"), new { @class = "form-control select2", @onchange = "GetSelectedValue(this.value)", @id = "Sectionlsts", disabled = "disabled" })
                            @Html.ValidationMessageFor(x => x.RoleId, "", new { @class = "text-danger" })
                        }


                    </td>

                    <td>
                        @*<a class=" btn btn-primary" onclick="viewDetails(@item.Exam_Notif_Id)" data-toggle="modal" data-target="#myModal">View</a>*@
                        @if (item.status_desc.ToString().Equals("Approved - Pending for Publish"))
                        {
                            <a class=" btn btn-primary" id="sendBtn" onclick="SendattndDetails(@item.attenId,@item.status_id)">Send</a>
                        }
                        else
                        {
                            <a class=" btn btn-primary" id="sendBtn" onclick="SendattndDetails(@item.attenId,@item.status_id)">Send</a>
                        }

                    </td>
                    @*<td>

            <div>
                <a href=" + pdfUrlPath + " target='_blank'>View</a>
            </div>
        </td>*@
                    <td>
                        @if (item.StatusId == 1)
                        {
                            <a class=" btn btn-primary" href='@Url.Action("AttendanceDet", "Attendance", new { AttendanceId = item.attenId})'>Edit</a>
                        }

                        @if (item.StatusId == 2)
                        {
                            <a class="btn btn-primary RateAnalysis" id="sendBtn" href='javascript:;' @*onclick="ViewDetails(@item.attenId,@item.StatusId)"*@>View</a>
                        }

                        <a class="btn btn-primary" id="sendBtn" onclick="GetCommentFileDetails(@item.attenId)">View</a>
                    </td>



                </tr>
                }
            </tbody>
        </table>
    </div>
</body>
</html>

<div class="modal fade" id="HistoryRemarksCommentsModal" role="dialog">
    <div class="modal-dialog modal-xl" style="width: 60%; margin: 30px auto; padding: 2px;">
        <div class="modal-content" style="padding:15px;">
            <div class="modal-header">
                <h4 class="modal-title">Remark Details</h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <br />
            <div>
                <input type="button" value="ViewAttendanceUploadFile" class="btn btn-primary" onclick="GetClientReport1()" style="margin-left:15px; width:250px;" id="btnFileView" />
            </div>
            <br />

            <table class="table table-striped table-hover text-center shadow clswidth" id="GetCommentRemarksDetails" style="width:100% !important" border="1" align="center"></table>

            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal" style="width: 20%;">OK</button>
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        $('#tblGrid').DataTable({

        });
    });

    var RoleId = '';
    function GetSelectedValue(ID1) {
        RoleId = ID1;
    }

    function ViewDetails(id, status) {
        
        $.ajax({
            type: "POST",
            url: "/Notification/PublishNotification",
            dataType: 'json',
            data: {
                Id: id,
                Status: status,
                //Loginid: RoleId,
            },

            success: function (response) {
                
                if (response == "Saved") {
                    //$('#sendBtn').attr("disabled", "disabled");
                    var _msg = "Published Success  fully Successfully";
                    //bootbox.alert(_msg);
                    bootbox.alert({ message: _msg, callback: function () { window.location.href = window.location.href; } });
                }
                else {
                    var _msg = "Fail to send";
                    bootbox.alert(_msg);
                }
            }, error: function (e) {
                var _msg = "Something went wrong.";
                bootbox.alert(_msg);
                $("#preloder, .loader").hide();
            }
        });
    }
    function SendattndDetails(id, status) {
        
        $.ajax({
            type: "POST",
            url: "/Attendance/AttendanceApproveStatus",
            dataType: 'json',
            data: {
                Id: id,
                Status: status,
                Loginid: RoleId,
            },

            success: function (response) {

                if (response == 1) {
                    //$('#sendBtn').attr("disabled", "disabled");
                    var _msg = "Sent Successfully";
                    bootbox.alert({ message: _msg, callback: function () { window.location.href = window.location.href; } });
                }
                else {
                    var _msg = "Fail to send";
                    bootbox.alert(_msg);
                }
            }, error: function (e) {
                var _msg = "Something went wrong.";
                bootbox.alert(_msg);
                $("#preloder, .loader").hide();
            }
        });
    }

    function GetCommentFileDetails(id) {

        $('#HistoryRemarksCommentsModal').modal('show');
        //NotifId = id;
        
        $.ajax({
            type: "Post",
            url: "/Notification/GetCommentFileDetails",
            data: { NotificationId: id },
            success: function (data) {
                var t = $('#GetCommentRemarksDetails').DataTable({
                    data: data,
                    destroy: true,
                    columns: [
                        { 'data': 'createdatetime', 'title': 'Sl No', 'className': 'text-center' },
                        { 'data': 'createdatetime', 'title': 'Date', 'className': 'text-left' },
                        { 'data': 'Exam_Notif_Number', 'title': 'Notification Number', 'className': 'text-left' },
                        { 'data': 'comments', 'title': 'Descriptioon', 'className': 'text-left' },
                        { 'data': 'user_name', 'title': 'Designation', 'className': 'text-left' },

                    ]
                });
                t.on('order.dt search.dt', function () {
                    t.column(0, { search: 'applied', order: 'applied' }).nodes().each(function (cell, i) {
                        cell.innerHTML = i + 1;
                    });
                }).draw();
               // NotifId = data[0].Exam_Notif_Number;
            }
        });
    }

    function GetClientReport1() {
        var pdf_file = $('#test').val();
        

        var urlPath = "../../Content//Uploads//" + file1 + " ";
        window.open(urlPath, '_blank');
        
    }


</script>

<script type="text/javascript">
   @*// var selectedTab = '@Model.selectTab';*@
    var pdf_file = $('#test').text();
    var file_path = '';
    $("body").on("click", "#tblGrid .RateAnalysis", function () {
        var $tdfile_path = row.find("td:nth-child(6)");
        file_path = $tdfile_path.text().trim();
    });
</script>


