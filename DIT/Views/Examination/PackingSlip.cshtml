@model Models.PackingSlip
@{
    ViewBag.Title = "PackingSlip";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<link href="~/Content/css/jquery.dataTables.min.css" rel="stylesheet" />
<script src="~/Scripts/jquery.dataTables.min.js"></script>
<script src="~/Content/frontend/js/bootstrap.js"></script>
<script src="~/Scripts/bootbox.js"></script>
<script src="~/Scripts/bootbox.min.js"></script>
<script src="~/Scripts/bootbox.locales.min.js"></script>
<script src="~/Content/frontend/js/jquery-ui.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>

<style>
    button {
        background-color: #5A8CD3;
        color: white;
    }

    button {
        background-color: #5A8CD3;
        color: white;
    }

    .content-box-gray .content {
        overflow: hidden;
        padding: 10px;
        font-size: 15px;
        border-bottom-left-radius: 5px;
        border-bottom-right-radius: 5px;
        border: 1px solid gray;
        color: #3385FF;
    }

    .content-box-gray .title {
        height: 50px;
        line-height: 30px;
        border-top-left-radius: 5px;
        border-top-right-radius: 5px;
        /*background: #5A8CD3;*/
        font-size: 18px;
        font-weight: bold;
        font-family: verdana;
        display: block;
        color: white;
        display: block;
        padding: 10px;
        border: 1px solid gray;
        border-bottom: none;
    }
</style>
<br />
<br />
<br />
<h4>
    <ul class="nav nav-tabs">
        <li>
            <a href="#tab_1" id="tab1" data-toggle="tab">Generate Packing Slip</a>
        </li>
    </ul>
</h4>
<div class="tab-content">
    <div class="tab-pane fade" id="tab_1">
        <div class="container" style="background-color:white;box-shadow: 0 2px 4px rgba(0,0,0,0.6);margin-top:20px; padding:20px;">
            <div class="row">
                <div class="col-lg-12">
                    <h3 style="text-align:center">Generate Packing Slip</h3>
                    <br /><br />
                    <div class="form-group row">
                        <div class="col-lg-6 col-md-6">
                            <div class="col-md-6">
                                <label for="txtAgencyRegnNo">Date<span style="color:red"> *</span></label>
                            </div>
                            <div class="col-md-6">
                                @Html.TextBoxFor(model => model.Exam_Date, "{0:dd/MM/yyyy}", new { @class = "form-control", autocomplete = "off", @type = "Date", style = " background-position:right; background-size:30px; ", @onchange = "GetSubjectAndTrade()" })
                            </div>
                        </div>
                    </div>
                    <div class="form-group row">
                        <div class="col-lg-6 col-md-6">
                            <div class="col-md-6">
                                <label for="txtAgencyRegnNo">Course Type <span style="color:red"> *</span></label>
                            </div>
                            <div class="col-md-6">
                                @Html.DropDownListFor(model => model.CourseTypeId, new SelectList(Model.CourseTypeList, "Value", "Text"), new { @class = "form-control select2" })
                            </div>
                        </div>
                        <div class="col-lg-6 col-md-6">
                            <div class="col-md-6">
                                <label for="txtAgencyRegnNo">Exam Center <span style="color:red"> *</span></label>
                            </div>
                            <div class="col-md-6">
                                @Html.DropDownListFor(model => model.ExamCenterId, new SelectList(Model.ExamCenterList, "Value", "Text"), new { @class = "form-control select2" })
                            </div>
                        </div>
                    </div>
                    <div class="form-group row">
                        <div class="col-lg-6 col-md-6">
                            <div class="col-md-6">
                                <label for="txtAgencyRegnNo">Trade<span style="color:red"> *</span></label>
                            </div>
                            <div class="col-md-6">
                                @Html.DropDownListFor(model => model.TradeId, new SelectList(Model.TradeList, "Value", "Text"), new { @class = "form-control select2" })
                            </div>
                        </div>
                        <div class="col-lg-6 col-md-6">
                            <div class="col-md-6">
                                <label for="txtAgencyRegnNo">Subject<span style="color:red"> *</span></label>
                            </div>
                            <div class="col-md-6">
                                @Html.TextBoxFor(model => model.SubjectType, new { @class = "form-control", @readOnly = "true" })
                            </div>
                        </div>
                    </div>

                    <br />
                    <br />
                    <div class="form-group row">
                        <div class="col-lg-4 col-md-4">
                            <div class="col-md-6">
                            </div>
                            <div class="col-md-6">
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-4">
                            <div class="col-md-6">
                                <input type="button" value="Generate" class="btn btn-primary" style="margin-left:15px; width:250px;" id="btnPackingSlipGen" />
                            </div>
                            <div class="col-md-6">
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-4">
                            <div class="col-md-6">
                            </div>
                            <div class="col-md-6">
                            </div>
                        </div>
                    </div>
                    <br />
                    <br />
                    <br />
                </div>
            </div>
        </div>
        <br />
        <br />
    </div>
</div>
<script type="text/javascript">

    var selectedTab = '@Model.selectTab';
    if (selectedTab != null)
    {
         if (selectedTab == 0) {
             $('.nav-tabs li:eq(0) a').tab('show')
             $('#SubjectType').val('');
        }
    }

    var SubjectTypeID = '';
    function GetSubjectAndTrade() {
        var examDate = $('#Exam_Date').val();

        $.ajax({
            type: 'POST',
            url: '/Examination/GetSubjectAndTrade',
            data: { ExamDate: examDate },
            success: function (result) {
                if (result != "Failed") {
                    $('#SubjectType').val(result.split('-')[0]);
                    SubjectTypeID = result.split('-')[1];
                } else {
                    bootbox.alert("Error while Getting Data");
                }
            }
        });
    }

    $('#btnUniqueIdentification').click(function (e) {
            bootbox.confirm({
                title: "Confirm",
                message: "Are you sure you want to Generate Unique Identification Code?",
                buttons: {
                    confirm: {
                        label: 'Yes',
                        className: 'btn-success'
                    },
                    cancel: {
                        label: 'No',
                        className: 'btn-danger'
                    }
                },
                callback: function (result) {
                    if (result == true) {
                        var model = {};
                        model.selectedTab = 0;

                        $.ajax({
                            type: 'POST',
                            url: '/Examination/GenerateUniqueCodeForTrainee',
                            data: { model: model },
                            success: function (result) {
                                if (result == "Success") {
                                    var msg = "Unique Identification Code Generated Sucessfully.";
                                    bootbox.alert({ message: msg, callback: function () { window.location.href = window.location.href; } });
                                } else {
                                    bootbox.alert("Error while Saving Data");
                                }
                            }
                        });
                    }
                }
            });
    });

    $('#btnPackingSlipGen').click(function (e) {
        bootbox.confirm({
            title: "Confirm",
            message: "Are you sure you want to Generate Packing Slip ?",
            buttons: {
                confirm: {
                    label: 'Yes',
                    className: 'btn-success'
                },
                cancel: {
                    label: 'No',
                    className: 'btn-danger'
                }
            },
            callback: function (result) {
                if (result == true) {
                    var model = {};
                    model.selectedTab = 0;
                    model.SubjectType = SubjectTypeID;
                    model.CourseTypeId = $('#CourseTypeId :selected').val();
                    model.ExamCenterId = $('#ExamCenterId :selected').val(); 
                    model.TradeId = $('#TradeId :selected').val();  

                    $.ajax({
                        type: 'POST',
                        url: '/Examination/GeneratePackingSlip',
                        data: { model: model },
                        success: function (result) {
                            if (result == "Success") {
                                var msg = "Packing Slip Generated Sucessfully.";
                                bootbox.alert({ message: msg, callback: function () { window.location.href = window.location.href; } });
                            } else {
                                bootbox.alert("Error while Saving Data");
                            }
                        }
                    });
                }
            }
        });
    });

</script>